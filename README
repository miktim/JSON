# Java 7+/Android JSON parser/generator, MIT (c) 2020-2022 miktim@mail.ru

Release notes:
  - Java SE 7+/Android RFC 8259 compliant package
    (see: https://datatracker.ietf.org/doc/rfc8259/?include_text=1 );
  - no external dependencies;
  - JavaScript JSON - like interface.

package org.miktim.json

Overview:

  Class JSON extends LinkedHashMap<String, Object>.

    - parser converts JSON text to Java objects:
      JSON object, String, Number (BigDecimal), Boolean, null, Object[] array of listed types;
    - JSON object members (name/value pairs) are stored in order of appearance/creation;
    - when the names within an object are not unique, parser stores the last value only;
    - JSON object setters accept any Java object, all Java primitives and primitive arrays;
    - AVOID RECURSION!;
    - in addition, the generator converts Java Collections to JSON arrays, Java Maps to JSON objects.
      The null key is converted to a "null" member name.
      Other Java objects are converted to string representation;
    - JSON text is generated as one line.
    
    Put, set, get notes:
    - RFC 8259 does not recommend using Java BigDecimal and BigInteger as JSON member values;
    - put, set methods cast Java primitives to the corresponding objects.
      Java objects and arrays are stored "as is" (as reference). 
      For example: int -> Integer, int[] -> int[], String[] -> String[]
    - after JSON text parsing or normalization, they are stored as:
      BigDecimal, Object[] {BigDecimal,...}, Object[] {String,...};
    - getters eliminate these differences by casting types to JSON-declared.
    
    Constructors:
      JSON(Object... members) throws IndexOutOfBoundsException; // name,value pairs
      JSON(String jsonText) throws IOException, ParseException;
      JSON(Reader reader) throws IOException, ParseException;

    Public methods:
      static Object parse(String jsonText) throws IOException, ParseException;
      static Object parse(Reader reader) throws IOException, ParseException;
      static String generate(Object obj); // generate JSON text
      static void generate(Object obj, Writer writer) throws IOException;

      List<String> listNames(); // returns list of member names
      boolean exists(String memberName); // alias of the inherited containsKey()
      Object put(String memberName, Object value); // inherited
      JSON set(String memberName, Object value);   // create or replace member
      Object get(String memberName);    // inherited
      Object remove(String memberName); // inherited

      Object get(String memberName, int... indices); // returns value or array element
      JSON getJSON(String memberName, int... indices) throws ClassCastException;
      String getString(String memberName, int... indices) throws ClassCastException;
      Number getNumber(String memberName, int... indices) throws ClassCastException;
      Boolean getBoolean(String memberName, int... indices) throws ClassCastException;
      Object[] getArray(String memberName, int... indices) throws ClassCastException;

      <T> T cast(String memberName, T sample, int... indices); // casting value or array by sample
      <T> T cast(String memberName, Class <T> cls, int... indices); // casting value or array by Class

      JSON normalize() throws IOException, ParseException; // not required to generate JSON text

      String toString(); // overridden, stringify JSON object
      String toString(String memberName, int... indices); 
        // stringify member or array element
 

  Class JSONAdapter;

    Casting a JSON variable or array to a Java primitive or array using a sample or class.
    - sample must be initialized;
    - casting null to a Java primitive returns corresponding initial value;
    - casting null to an array returns an empty array;
    - casting null to String returns "null";
    - casting null to other Java objects returns null;
    - casting to null returns null.

    static <T> T cast(Object obj, T sample);
    static <T> T cast(Object obj, Class <T> cls);


  Abstract class JSONObject;

    Unloads/loads the accessible fields (properties) of the Java object to/from the JSON object.
    - Java final, interface, abstract, transient, strict fields are ignored;
    - see JSON set/get/cast rules for Java object fields in the notes for JSON object and JSONAdapter;
    - arrays and collections of objects must be managed using replacer/reviewer.

    Constant:
      static final Object IGNORED; // returns from replacer/reviver to skip the field

    Methods:
      Object toJSON()
        throws IllegalArgumentException, IllegalAccessException;
         // returns JSON object
         // convertible object parameters must be initialized
      protected Object replacer(String name, Object value); 
         // first call with object class name and empty JSON object as value
      public String toJSONText()
        throws IllegalArgumentException, IllegalAccessException
         // returns JSON text as one line

      Object fromJSON(Object jsonObj)
        throws IllegalArgumentException, IllegalAccessException;
         // returns this object
         // convertible object parameters must be initialized
      protected Object reviver(String name, Object value); 
         // first call with object class name and obj argument as value
      public Object fromJSONText(String jsonText)
        throws IOException, ParseException, IllegalArgumentException, IllegalAccessException 

      static final boolean isClassName(String name);
      protected <T> T castMember(String memberName, JSON jsonObj, T sample);
         // returns the sample if JSON member does not exists
      protected void setIgnored(String[] fldNames); // set ignored field names
      protected String[] getIgnored()

Usage see:
  ./test/json/JSONTest.java
  ./test/json/JSONAdapterTest.java
  ./test/json/JSONObjectTest.java

The result of the JSON parsing test for compliance with RFC 8259:
  https://miktim.github.io/JSONTestSuite/results/parsing.html
